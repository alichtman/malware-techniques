#include <stdio.h>
#include <stdlib.h>
#include <sys/types.h>
#include <sys/ptrace.h>
#include <unistd.h>

/**
 * Unlike BSD (the Linux distribution macOS is based upon), macOS ships
 * with a crippled ptrace functionality. You can read more about this in
 * this post: http://uninformed.org/index.cgi?v=4&a=3&p=14
 *
 * Here is an example of an ineffective anti-debug technique sometimes
 * used in macOS malware. It's not totally worthless, as it does stop a
 * debugger from attaching to the process after the ptrace call. But it
 * allows a debugger to be attached before the line is called. This means
 * that you can null out the PT_DENY_ATTACH argument before the syscall
 * is executed in a debugger like lldb. The exact process is detailed here:
 * https://alexomara.com/blog/defeating-anti-debug-techniques-macos-ptrace-variants/
 */
int main(int argc, char* argv[]) {
	ptrace(PT_DENY_ATTACH, 0, 0, 0);
	printf("SUCCESS\n");
	return 0;
}
